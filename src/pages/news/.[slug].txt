---
import Layout from "../../layouts/Layout.astro";
import { contentfulClient } from "../../lib/contentful";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";
import type { BlogPost } from "../../lib/contentful";

export const prerender = false;


let post;
let aa
let aas
const { slug } = Astro.params;
try {
  const data = await contentfulClient.getEntries<BlogPost>({
    content_type: "blogPost",
    "fields.slug": slug,
  });

   aa = await contentfulClient.getAsset(data.items[0].fields.cover.sys.id);
//console.log(aa.fields.file?.url)

  aas = await contentfulClient.getAssets();
console.log(aas)

  const { title, date, content, cover, multimedia } = data.items[0].fields;
  post = {
    title,
    cover,
    multimedia,
    date: new Date(date).toLocaleDateString(),
    content: documentToHtmlString(content),

  };
  //const a = post.cover as 
} catch (error) {
  return Astro.redirect("/404");
}

/* interface Item {
  fields: {
    file: {
      contentType: string;
      url: string;
      details: {
        image: {
          width: number;
          height: number;
        };
      };
    };
    title: string;
  };
} */
---

<Layout title="Welcome to Astro." description="La web de cebem">
	<main>
		<h1>{post?.title}</h1>
    <time>{post?.date}</time>
    <img src={aa.fields.file?.url} />
    <article set:html={post?.content} />
  
        <div class="flex gap-4">
    {post?.multimedia?.map((item:any) => {
      const a = item.fields.cover
      if (item.fields.file.contentType.includes("image")) {
        return (
          <img
            width={100}
            src={item.fields.file.url}
            alt={item.fields.title}
            width={item.fields.file.details.image.width}
            height={item.fields.file.details.image.height}
          />
        );
      }
      
      if (item.fields.file.contentType.includes("video")) {
        return (
          <video
            src={item.fields.file.url}
            controls
            width={item.fields.file.details.image.width}
            height={item.fields.file.details.image.height}
          />
        );
      }
      if (item.fields.file.contentType.includes("pdf")) {
        return (
            <div class="p-5 border rounded">
            <a class="" href={item.fields.file.url} target="_blank">Ver pdf</a>
            </div>
        );
      }
      return null;
    })
}
</div>
   <img src={post?.cover.fields.file.url} alt={post?.cover.fields.title} />
	
</main>
</Layout>